<script>
        let tg = window.Telegram.WebApp;
        tg.expand(); 

        // ❗️ ВАЖЛИВО: Актуалізуйте цю цифру відповідно до бюджету на 2026 рік
        const LIVING_WAGE = 3200; 

        const mainButton = tg.MainButton;
        mainButton.setText("СФОРМУВАТИ КВИТАНЦІЮ");
        mainButton.textColor = "#FFFFFF";
        mainButton.color = "#2cab37"; 

        function calculate() {
            let type = document.getElementById("claimType").value;
            let priceInput = document.getElementById("claimPrice").value;
            let price = parseFloat(priceInput);
            let fee = 0;

            // Скидаємо відображення
            document.getElementById("resultBox").style.display = "none";
            mainButton.hide();

            // 1. НЕМАЙНОВИЙ ПОЗОВ (0.4 ПМ)
            if (type === "non_money") {
                document.getElementById("priceContainer").style.display = "none";
                fee = LIVING_WAGE * 0.4;
            } 
            
            // 2. МАЙНОВИЙ ПОЗОВ (1% ціни, але є рамки)
            else if (type === "money") {
                document.getElementById("priceContainer").style.display = "block";
                
                // Перевірка, чи ввів юзер число
                if (!price || price <= 0) return;

                let calculatedFee = price * 0.01; // 1 відсоток
                let minFee = LIVING_WAGE * 0.4;   // Мінімальний поріг
                let maxFee = LIVING_WAGE * 5;     // Максимальний поріг (для фізосіб)

                // Логіка: не менше Min, але й не більше Max
                fee = Math.max(minFee, Math.min(calculatedFee, maxFee));
            }

            // 3. МОРАЛЬНА ШКОДА (Складніша логіка)
            // Якщо ціна позову <= 5 ПМ, то ставка як за немайновий (0.4 ПМ),
            // якщо більше — 1.5% ціни позову.
            else if (type === "moral") {
                document.getElementById("priceContainer").style.display = "block";
                if (!price || price <= 0) return;

                if (price <= LIVING_WAGE * 5) {
                    fee = LIVING_WAGE * 0.4;
                } else {
                    fee = price * 0.015; // 1.5%
                    // У моральної шкоди немає верхньої межі (max)!
                }
            }

            // Відображення результату
            document.getElementById("finalFee").innerText = fee.toFixed(2) + " грн";
            document.getElementById("resultBox").style.display = "block";
            mainButton.show();
            
            // Передача даних боту
            mainButton.onClick(function() {
                tg.sendData(JSON.stringify({
                    fee: fee.toFixed(2), 
                    type: type, 
                    price: price || 0
                }));
            });
        }
        
        // Запускаємо розрахунок при старті (для ініціалізації)
        calculate();
    </script>
