<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background: var(--tg-theme-bg-color, #fff); color: var(--tg-theme-text-color, #000); padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; background: var(--tg-theme-secondary-bg-color, #f0f0f0); color: var(--tg-theme-text-color, #000); box-sizing: border-box;}
        button { width: 100%; padding: 15px; background: var(--tg-theme-button-color, #3390ec); color: var(--tg-theme-button-text-color, #fff); border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; font-size: 16px;}
        
        /* –ö–ª–∞—Å –¥–ª—è –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –±–ª–æ–∫—ñ–≤ */
        .hidden { display: none; }
    </style>
</head>
<body>

    <h3 id="form-title">üìÑ –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—É</h3>

    <div id="block-receipt" class="hidden">
        <div class="form-group">
            <label>üë§ –ü–Ü–ë –ë–æ—Ä–∂–Ω–∏–∫–∞:</label>
            <input type="text" id="r_name" placeholder="–Ü–≤–∞–Ω–æ–≤ –Ü–≤–∞–Ω">
        </div>
        <div class="form-group">
            <label>üë§ –ü–Ü–ë –ö—Ä–µ–¥–∏—Ç–æ—Ä–∞:</label>
            <input type="text" id="r_lender" placeholder="–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä–æ">
        </div>
        <div class="form-group">
            <label>üí∞ –°—É–º–∞ (–≥—Ä–Ω):</label>
            <input type="number" id="r_amount">
        </div>
        <div class="form-group">
            <label>üìÖ –î–∞—Ç–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è:</label>
            <input type="date" id="r_date">
        </div>
    </div>

    <div id="block-contract" class="hidden">
        <div class="form-group">
            <label>üè¢ –ó–∞–º–æ–≤–Ω–∏–∫ (–ü–Ü–ë/–ö–æ–º–ø–∞–Ω—ñ—è):</label>
            <input type="text" id="c_client" placeholder="–¢–û–í –†–æ–≥–∏ —Ç–∞ –ö–æ–ø–∏—Ç–∞">
        </div>
        <div class="form-group">
            <label>üë®‚Äçüíª –í–∏–∫–æ–Ω–∞–≤–µ—Ü—å (–ü–Ü–ë):</label>
            <input type="text" id="c_contractor" placeholder="–§–û–ü –Ü–≤–∞–Ω–æ–≤">
        </div>
        <div class="form-group">
            <label>üõ† –û–ø–∏—Å –ø–æ—Å–ª—É–≥–∏:</label>
            <textarea id="c_service" rows="3" placeholder="–†–æ–∑—Ä–æ–±–∫–∞ Telegram –±–æ—Ç–∞"></textarea>
        </div>
        <div class="form-group">
            <label>üíµ –í–∞—Ä—Ç—ñ—Å—Ç—å —Ä–æ–±—ñ—Ç (–≥—Ä–Ω):</label>
            <input type="number" id="c_price">
        </div>
    </div>

    <button onclick="sendData()">–°—Ç–≤–æ—Ä–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç</button>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // 1. –í–∏–∑–Ω–∞—á–∞—î–º–æ, —è–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –º–∏ –≤—ñ–¥–∫—Ä–∏–ª–∏ (—á–∏—Ç–∞—î–º–æ URL ?type=...)
        const urlParams = new URLSearchParams(window.location.search);
        const docType = urlParams.get('type'); // 'receipt' –∞–±–æ 'contract'

        // 2. –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ—Ç—Ä—ñ–±–Ω—É —Ñ–æ—Ä–º—É
        if (docType === 'receipt') {
            document.getElementById('block-receipt').classList.remove('hidden');
            document.getElementById('form-title').innerText = "üìÑ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–æ–∑–ø–∏—Å–∫–∏";
        } else if (docType === 'contract') {
            document.getElementById('block-contract').classList.remove('hidden');
            document.getElementById('form-title').innerText = "üìù –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ–≥–æ–≤–æ—Ä—É";
        } else {
            document.body.innerHTML = "<h3>‚ùå –ü–æ–º–∏–ª–∫–∞: –Ω–µ–≤—ñ–¥–æ–º–∏–π —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç—É</h3>";
        }

        // 3. –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö
        function sendData() {
            let data = {};

            if (docType === 'receipt') {
                data = {
                    action: "generate_receipt",
                    name: document.getElementById('r_name').value,
                    lender: document.getElementById('r_lender').value,
                    amount: document.getElementById('r_amount').value,
                    date: document.getElementById('r_date').value
                };
            } else if (docType === 'contract') {
                data = {
                    action: "generate_contract",
                    client: document.getElementById('c_client').value,
                    contractor: document.getElementById('c_contractor').value,
                    service_desc: document.getElementById('c_service').value,
                    price: document.getElementById('c_price').value
                };
            }

            // –í–∞–ª—ñ–¥–∞—Ü—ñ—è (–ø—Ä–æ—Å—Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø–æ—Ä–æ–∂–Ω–µ—á—É)
            if (Object.values(data).some(x => x === "")) {
                tg.showPopup({message: "–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!"});
                return;
            }

            tg.sendData(JSON.stringify(data));
        }
    </script>
</body>
</html>
